---
title: 清空输入缓冲区
date: 2023-11-16 14:56:00
tags:
    - C/C++
---
在C语言中，`fflush(stdin)` 和 `rewind(stdin)` 主要用于清空输入缓冲区。然而，它们并不是标准C的一部分，因此在不同的编译器和平台上可能表现不同。<!--more-->

在标准C中，`fflush(stdin)` 的行为是未定义的，因为 `fflush` 函数的主要目的是刷新输出缓冲区，而不是清空输入缓冲区。因此，不建议在输入流上使用 `fflush`。

对于 `rewind(stdin)`，同样地，它也可能在一些情况下表现不一致，因为 `rewind` 主要设计用于文件流，而 `stdin` 是一个标准输入流。

对于如下代码：
```c
#include <stdio.h>

int main()
{
    int i, ret;
    while (fflush(stdin), (ret = scanf("%d", &i)) != EOF)
        printf("i = %d\n", i);
    return 0;
}
```

可以使用如下替代方案：
```c
#include <stdio.h>

int main() {
    int i, ret;
    
    while ((ret = scanf("%d", &i)) != EOF) {
        if (ret == 0) {
            // Handle invalid input (non-integer)
            printf("Invalid input. Please enter an integer.\n");

            // Clear the input buffer
            while (getchar() != '\n');
        } else {
            printf("i = %d\n", i);
        }
    }

    return 0;
}
```

这个修改后的代码在输入无效数据（非整数）时会进行错误处理，并清空输入缓冲区。通过使用 `getchar()` 循环读取并丢弃字符，直到遇到换行符为止，可以确保输入缓冲区中的无效数据被清空。
