---
title: 安卓手机设置路由转发，充当旁路由
date: 2023-06-24 14:26:19
tags:
    - 路由器
declare: true
---
- root手机
- 下载[Termux](https://github.com/termux/termux-app/releases)<!--more-->
- 先将手机设置为静态ip
- 进入root用户：`su`
- 一键脚本
```bash
cd /data/local
mkdir proxy
cd proxy
vim proxy.sh

# 添加如下内容
#!/system/bin/sh

tun='tun0' #虚拟接口名称
dev='wlan0' #物理接口名称，eth0、wlan0
interval=3 #检测网络状态间隔(秒)
pref=18000 #路由策略优先级

# 开启IP转发功能
sysctl -w net.ipv4.ip_forward=1

# 清除filter表转发链规则
iptables -F FORWARD

# 添加NAT转换，部分第三方VPN需要此设置否则无法上网，若要关闭请注释掉
iptables -t nat -A POSTROUTING -o $tun -j MASQUERADE

# 添加路由策略
ip rule add from all table main pref $pref
ip rule add from all iif $dev table $tun pref $(expr $pref - 1)

contain="from all iif $dev lookup $tun"

while true ;do
    if [[ $(ip rule) != *$contain* ]]; then
            if [[ $(ip ad|grep 'state UP') != *$dev* ]]; then
                echo -e "[$(date "+%H:%M:%S")]dev has been lost."
            else
                ip rule add from all iif $dev table $tun pref $(expr $pref - 1)
                echo -e "[$(date "+%H:%M:%S")]network changed, reset the routing policy."
            fi
    fi
    sleep $interval
done

```
- 赋予可执行权限：`chmod +x proxy.sh`
- 执行：`nohup ./proxy.sh &`

--------------------------
[闲置安卓手机当旁路网关，无需购买软路由即可让家里所有设备实现科学上网](https://bulianglin.com/archives/android-gateway.html)
[【全网首发】闲置安卓手机充当软路由，突破第三方VPN客户端设备限制，接管局域网所有设备上网数据实现全家科学上网，旁路网关、旁路由、透明代理、透明网关、网关代理、网关模式、代替openwrt软路由](https://www.youtube.com/watch?v=r6nXCgYkXTQ&t=10s&ab_channel=%E4%B8%8D%E8%89%AF%E6%9E%97)
[termux指南](https://zhuanlan.zhihu.com/p/612865403)